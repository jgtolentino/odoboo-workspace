<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Magic Link Email Template -->
        <record id="magic_link_email_template" model="mail.template">
            <field name="name">Magic Link Login</field>
            <field name="model_id" ref="base.model_res_users"/>
            <field name="subject">Your Magic Link to Sign In</field>
            <field name="email_from">${object.company_id.email or 'noreply@insightpulse.ai'}</field>
            <field name="email_to">${object.email}</field>
            <field name="body_html" type="html">
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 20px; text-align: center;">
                        <h1 style="color: white; margin: 0;">Sign in to Odoo</h1>
                    </div>
                    <div style="background: #ffffff; padding: 40px 30px;">
                        <p style="font-size: 16px; color: #333; line-height: 1.6;">
                            Hello <strong>${object.name}</strong>,
                        </p>
                        <p style="font-size: 16px; color: #333; line-height: 1.6;">
                            Click the button below to sign in to your Odoo account. This link will expire in 15 minutes.
                        </p>
                        <div style="text-align: center; margin: 30px 0;">
                            <a href="${ctx.get('magic_link')}"
                               style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                      color: white;
                                      padding: 15px 40px;
                                      text-decoration: none;
                                      border-radius: 5px;
                                      font-size: 16px;
                                      font-weight: bold;
                                      display: inline-block;">
                                Sign In Now
                            </a>
                        </div>
                        <p style="font-size: 14px; color: #666; line-height: 1.6;">
                            Or copy and paste this link into your browser:
                        </p>
                        <p style="font-size: 12px; color: #999; word-break: break-all; background: #f5f5f5; padding: 10px; border-radius: 3px;">
                            ${ctx.get('magic_link')}
                        </p>
                        <hr style="border: none; border-top: 1px solid #eee; margin: 30px 0;"/>
                        <p style="font-size: 12px; color: #999;">
                            If you didn't request this email, you can safely ignore it.
                        </p>
                    </div>
                    <div style="background: #f5f5f5; padding: 20px; text-align: center; font-size: 12px; color: #999;">
                        <p style="margin: 0;">Â© ${datetime.datetime.now().year} InsightPulse AI. All rights reserved.</p>
                    </div>
                </div>
            </field>
        </record>

        <!-- Cron Job to Clean Up Expired Tokens -->
        <record id="ir_cron_cleanup_magic_links" model="ir.cron">
            <field name="name">Clean Up Expired Magic Link Tokens</field>
            <field name="model_id" ref="model_auth_magic_link_token"/>
            <field name="state">code</field>
            <field name="code">model.cleanup_expired_tokens()</field>
            <field name="interval_number">1</field>
            <field name="interval_type">hours</field>
            <field name="numbercall">-1</field>
            <field name="active" eval="True"/>
        </record>
    </data>
</odoo>
